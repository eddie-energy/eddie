// SPDX-FileCopyrightText: 2024-2025 The EDDIE Developers <eddie.developers@fh-hagenberg.at>
// SPDX-License-Identifier: Apache-2.0

package energy.eddie.api.agnostic.aiida;

import com.fasterxml.jackson.annotation.JsonProperty;
import jakarta.validation.constraints.NotBlank;

import java.util.List;
import java.util.UUID;

public class QrCodeDto {
    /**
     * Token Access token to be included by AIIDA for the handshake.
     */
    @JsonProperty
    private final UUID eddieId;
    /**
     * Permissions as generated by this region connector.
     */
    @JsonProperty
    private final List<QrCodePermissionDto> permissions;
    /**
     * URL template used by AIIDA to send the handshake request.
     * The placeholder {permissionId} is replaced with the actual permission ID.
     */
    @JsonProperty
    @NotBlank(message = "must not be blank")
    private final String handshakeUrlTemplate;
    /**
     * Access token to be included by AIIDA for the handshake.
     */
    @JsonProperty("bearerToken")
    @NotBlank(message = "must not be blank")
    private final String accessToken;

    @SuppressWarnings("unused")
    private QrCodeDto() {
        // for deserialization
        eddieId = UUID.randomUUID();
        permissions = List.of();
        handshakeUrlTemplate = "";
        accessToken = "";
    }

    public QrCodeDto(UUID eddieId, List<QrCodePermissionDto> permissions, String handshakeUrlTemplate) {
        this.eddieId = eddieId;
        this.permissions = permissions;
        this.handshakeUrlTemplate = handshakeUrlTemplate;
        // This token will be set by Jackson after deserialization
        this.accessToken = "";
    }

    public UUID eddieId() {
        return eddieId;
    }

    public List<QrCodePermissionDto> permissions() {
        return permissions;
    }

    public String handshakeUrlTemplate() {
        return handshakeUrlTemplate;
    }

    public String accessToken() {
        return accessToken;
    }
}