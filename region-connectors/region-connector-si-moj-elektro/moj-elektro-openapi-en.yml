openapi: 3.0.1
externalDocs:
  url: https://docs.informatika.si/mojelektro/api/
info:
  title: Moj elektro API
  description: Programming interface to services for providing data to the user on the Moj Elektro portal
  version: "1.0"
  contact:
    email: podpora@mojelektro.si

servers:
  - description: Test environment
    url: https://api-test.informatika.si/mojelektro/v1
  - description: Production environment
    url: https://api.informatika.si/mojelektro/v1

security:
  - X-API-TOKEN: [ ]

paths:
  /meter-readings:
    get:
      tags:
        - meter-readings
      operationId: getMeterReadings
      summary: 15-minute measurement data and daily states
      description: 15-minute measurement data and daily states in CIM structure. Detailed descriptions of individual registers by which you can query are obtained with the GET /reading-type method.
      parameters:
        - $ref: "#/components/parameters/UsagePoint"
        - $ref: "#/components/parameters/StartTime"
        - $ref: "#/components/parameters/EndTime"
        - $ref: "#/components/parameters/Option"
      responses:
        200:
          $ref: "#/components/responses/MeterReadingsResponse"
        400:
          $ref: "#/components/responses/InvalidParametersErrorResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"

  /merilno-mesto/{identifikator}:
    get:
      tags:
        - merilno-mesto
      operationId: getMerilnoMesto
      summary: Metering point data
      description: Data of the metering point with technical details
      parameters:
        - $ref: "#/components/parameters/Identifikator"
      responses:
        200:
          $ref: "#/components/responses/MerilnoMestoResponse"
        400:
          $ref: "#/components/responses/InvalidParametersErrorResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"
        404:
          $ref: "#/components/responses/NotFoundResponse"

  /merilna-tocka/{gsrn}:
    get:
      tags:
        - merilna-tocka
      operationId: getMerilnaTocka
      summary: Metering point data
      description: Contractual data of the metering point (payer, addressee, supplier, ...)
      parameters:
        - $ref: "#/components/parameters/GsrnMerilneTocke"
      responses:
        200:
          $ref: "#/components/responses/MerilnaTockaResponse"
        400:
          $ref: "#/components/responses/InvalidParametersErrorResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"
        404:
          $ref: "#/components/responses/NotFoundResponse"

  /reading-qualities:
    get:
      tags:
        - reading-qualities
      operationId: getReadingQualities
      responses:
        200:
          $ref: "#/components/responses/ReadingQualitiesResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"

  /reading-type:
    get:
      tags:
        - reading-types
      operationId: getReadingTypes
      responses:
        200:
          $ref: "#/components/responses/ReadingTypesResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"

components:
  parameters:
    UsagePoint:
      name: usagePoint
      description: Unified identifier of the metering point
      in: query
      schema:
        $ref: "#/components/schemas/Gsrn"

    StartTime:
      name: startTime
      description: Start date of the query interval in the format YYYY-MM-DD
      in: query
      schema:
        $ref: "#/components/schemas/Date"

    EndTime:
      name: endTime
      description: End date of the query interval in the format YYYY-MM-DD
      in: query
      schema:
        $ref: "#/components/schemas/Date"

    Option:
      name: option
      description: "List of registers by which you query. Each register is entered in the form: ReadingType=32.0.2.4.1.2.12.0.0.0.0.0.0.0.0.3.72.0"
      in: query
      schema:
        $ref: "#/components/schemas/Options"

    Identifikator:
      description: Identifier of the metering point
      name: identifikator
      in: path
      required: true
      schema:
        type: string

    GsrnMerilneTocke:
      description: GSRN of the metering point
      name: gsrn
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Gsrn"

  responses:
    MeterReadingsResponse:
      description: Response for measurements
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/MeterReadings"

    MerilnoMestoResponse:
      description: Contains data of the metering point
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/MerilnoMestoPolno"

    MerilnaTockaResponse:
      description: Contains data of the metering point
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/MerilnaTockaPolno"

    ReadingQualitiesResponse:
      description: Code list of values for ReadingQualities
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ReadingQualities"

    ReadingTypesResponse:
      description: Code list of values for ReadingType
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ReadingTypes"

    InvalidParametersErrorResponse:
      description: Error in input parameters
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

    AuthorizationRequiredErrorResponse:
      description: Missing authorization data
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

    NotAuthorizedErrorResponse:
      description: Provided authorization data does not allow access
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

    NotFoundResponse:
      description: Data not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

  schemas:
    Gsrn:
      description: Unified identifier of the metering point
      type: string

    ReadingTypeValue:
      description: Type of reading
      type: string

    ReadingTypes:
      type: array
      items:
        $ref: "#/components/schemas/ReadingType"

    ReadingType:
      type: object
      properties:
        naziv:
          description: Name
          type: string
        oznaka:
          description: Designation
          type: string
        tip:
          description: Type
          type: string
        perioda:
          description: Period
          type: string
        opis:
          description: Description
          type: string
        readingType:
          $ref: "#/components/schemas/ReadingTypeValue"
        readingTypeBrezObracuna:
          $ref: "#/components/schemas/ReadingTypeValue"
        readingTypeObracun:
          $ref: "#/components/schemas/ReadingTypeValue"
        vrsta:
          $ref: "#/components/schemas/ReadingTypeValueType"

    ReadingTypeValueType:
      type: string
      enum:
        - KOLICINA
        - STANJE

    ReadingValue:
      description: Reading value
      type: string

    ReadingQualityType:
      type: string

    ReadingQuality:
      description: Status of the reading. Descriptions of individual statuses are available in the GET /reading-qualities method.
      type: object
      properties:
        readingQualityType:
          $ref: "#/components/schemas/ReadingQualityType"

    ReadingQualityWithDescription:
      allOf:
        - $ref: "#/components/schemas/ReadingQuality"
      type: object
      properties:
        description:
          description: Description of the reading status
          type: string

    ReadingQualities:
      type: array
      description: List of reading statuses. If the list is empty or not present, the reading is considered valid.
      items:
        $ref: "#/components/schemas/ReadingQualityWithDescription"

    Date:
      type: string
      description: Date timestamp in ISO format
      example: 2023-19-12
      format: date

    DateTime:
      type: string
      description: Timestamp in ISO format with time zone offset
      example: 2023-12-19 00:00:15+02:00
      format: date-time

    Options:
      type: array
      items:
        $ref: "#/components/schemas/Option"

    Option:
      type: string
      description: ReadingType value by which you query
      pattern: .+=.+

    IntervalReading:
      description: Reading
      type: object
      properties:
        timestamp:
          description: Reading timestamp
          type: string
          format: date-time
        value:
          $ref: "#/components/schemas/ReadingValue"
        readingQualities:
          description: List of reading statuses
          type: array
          items:
            $ref: "#/components/schemas/ReadingQuality"

    IntervalBlock:
      description: Time block for an individual register
      type: object
      properties:
        readingType:
          $ref: "#/components/schemas/ReadingTypeValue"
        intervalReadings:
          description: List of readings
          type: array
          items:
            $ref: "#/components/schemas/IntervalReading"

    MeterReadings:
      description: Measurement values
      type: object
      properties:
        usagePoint:
          $ref: "#/components/schemas/Gsrn"
        messageCreated:
          description: Message creation timestamp
          type: string
          format: date-time
        intervalBlocks:
          description: List of time blocks for an individual register
          type: array
          items:
            $ref: "#/components/schemas/IntervalBlock"

    PoslovniPartner:
      description: Business partner data
      type: object
      properties:
        naziv:
          description: Name of the business partner
          type: string
        davcnaSt:
          description: Tax number of the business partner
          type: string
        maticnaSt:
          description: Registration number of the business partner
          type: string
        naslov:
          description: Address of the business partner
          type: string

    VrstaMerilneTocke:
      description: Type of metering point
      type: string
      enum:
        - OMTO
        - MTP

    EnotniIdentifikatorMerilnegaMesta:
      description: Unified identifier of the metering point
      type: string

    IdentifikatorMerilnegaMesta:
      description: Identifier of the metering point
      type: object
      properties:
        enotniIdentifikatorMerilnegaMesta:
          $ref: "#/components/schemas/EnotniIdentifikatorMerilnegaMesta"
        gsrn:
          $ref: "#/components/schemas/Gsrn"

    Decimal:
      type: string

    MerilnoMesto:
      description: Metering point data
      type: object
      properties:
        identifikator:
          $ref: "#/components/schemas/IdentifikatorMerilnegaMesta"
        merilneTocke:
          type: array
          items:
            $ref: "#/components/schemas/MerilnaTocka"

    MerilnoMestoPolno:
      description: Metering point data
      allOf:
        - $ref: "#/components/schemas/MerilnoMesto"
        - type: object
          properties:
            naziv:
              description: Name of the metering point
              type: string
            naslov:
              description: Address of the metering point
              type: string
            tockaPrikljucitve:
              description: Connection point
              $ref: "#/components/schemas/TockaPrikljucitve"
            pogodbeniPodatki:
              description: Contractual data
              $ref: "#/components/schemas/PogodbeniPodatki"
            lastnik:
              description: Owner of the metering point
              $ref: "#/components/schemas/PoslovniPartner"
            tehnicniPodatki:
              description: Technical data of the metering point
              $ref: "#/components/schemas/TehnicniPodatki"

    TockaPrikljucitve:
      description: Connection point of the metering point
      type: object
      properties:
        rtp:
          description: RTP
          type: string
        sn:
          description: SN extract
          type: string
        tp:
          description: TP
          type: string
        nn:
          description: NN extract
          type: string

    PogodbeniPodatki:
      description: Contractual data of the metering point
      type: object
      properties:
        stevilkaSzP:
          description: Connection agreement number
          type: integer
        nazivNapetostnegaNivoja:
          description: Name of the voltage level
          type: string
        oznakaNapetostnegaNivoja:
          description: Designation of the voltage level
          type: string
        nazivNacinaPrikljucitve:
          description: Name of the connection method
          type: string
        oznakaNacinaPrikljucitve:
          description: Designation of the connection method
          type: integer
        vrstaPrikljucka:
          description: Type of connection
          type: string
        steviloFaz:
          description: Number of phases
          type: integer
        vrstaOmejevalcaToka:
          description: Type of current limiter
          type: string
        idVrsteOmejevalcaToka:
          description: Identifier of the current limiter type
          type: integer
        jakostOmejevalcaToka:
          description: Strength of the current limiter
          type: integer
        prikljucnaMoc:
          description: Connection power
          type: integer
        instaliranaMocProizvodnje:
          description: Installed production power
          $ref: "#/components/schemas/Decimal"
        virPrimarnegaEnergenta:
          description: Source of primary energy (energy source) for producers
          type: string
        daljinskoCitanje:
          description: Flag indicating if the metering point is on remote reading
          type: boolean
        obstoj15MinutneMeritve:
          description: Flag indicating if the metering point has 15-minute measurements
          type: boolean
        idFrekvenceOdbiranja:
          description: Identifier of the reading frequency
          type: integer
        nazivFrekvenceOdbiranja:
          description: Name of the reading frequency
          type: string
        mesecObracuna:
          description: Billing month
          type: integer

    TehnicniPodatki:
      description: Technical data of the metering point
      type: object
      properties:
        tipStevca:
          description: Name of the meter type
          type: string
        statisticnaPopulacija:
          description: Designation of the statistical population
          type: string
        tovarniskaStevilkaMkn:
          description: Factory number of the meter
          type: string
        velikostPopulacije:
          description: Population size
          type: integer
        letoIzdelave:
          description: Year of meter manufacture
          type: integer
        zaporednaStPreizkusa:
          description: Sequential test number
          type: integer
        datumVeljavnostiZiga:
          description: Expiry date of the stamp
          $ref: "#/components/schemas/Date"

    MerilnaTocka:
      description: Metering point data
      type: object
      properties:
        gsrn:
          $ref: "#/components/schemas/Gsrn"
        vrsta:
          $ref: "#/components/schemas/VrstaMerilneTocke"

    MerilnaTockaPolno:
      allOf:
        - $ref: "#/components/schemas/MerilnaTocka"
        - type: object
          properties:
            naziv:
              description: Name of the metering point
              type: string
            vrsta:
              $ref: "#/components/schemas/VrstaMerilneTocke"
            dobavitelj:
              $ref: "#/components/schemas/Dobavitelj"
            obracunIzgub:
              description: Flag indicating if losses are calculated at the metering point
              type: boolean
            procentIzgub:
              description: Percentage of losses
              type: integer
            steviloTarifMerjenja:
              description: Number of measurement tariffs
              type: integer
            letneObratovalneUre:
              description: Annual operating hours
              type: integer
            placnikAliProdajalec:
              description: Payer or seller at the metering point
              $ref: "#/components/schemas/PoslovniPartner"
            naslovnik:
              description: Addressee at the metering point
              $ref: "#/components/schemas/PoslovniPartner"
            obracunskaMoc:
              description: Billing (connection) power
              type: integer
            nacinObracuna:
              description: Billing method
              $ref: "#/components/schemas/NacinObracuna"
            idVrstaOdjema:
              description: Identifier of the consumption type
              type: integer
            nazivVrstaOdjema:
              description: Name of the consumption type
              type: string
            stPogodbeOUporabiSistema:
              description: System usage agreement number
              type: string
            nacinOskrbe:
              description: Supply method
              type: string
            dogovorjeneMoci:
              description: List of agreed powers
              type: array
              items:
                $ref: "#/components/schemas/DogovorjenaMoc"
            merilnaMesta:
              description: List of metering points involved in this metering point
              type: array
              items:
                $ref: "#/components/schemas/MerilnoMesto"

    DogovorjenaMoc:
      description: Agreed power data
      type: object
      properties:
        datumVnosa:
          description: Date of entry of agreed power
          $ref: "#/components/schemas/Date"
        datumOd:
          description: Start date of agreed power
          $ref: "#/components/schemas/DateTime"
        datumDo:
          description: End date of agreed power
          $ref: "#/components/schemas/DateTime"
        nacinDolocitve:
          description: Method of determining agreed power
          $ref: "#/components/schemas/NacinDolocitveDogovorjeneMoci"
        oznakaIzracuna:
          description: Designation of agreed power calculation
          $ref: "#/components/schemas/OznakaIzracunaDogovorjeneMoci"
        casovniBlok1:
          description: Value of agreed power in time block 1
          $ref: "#/components/schemas/Decimal"
        casovniBlok2:
          description: Value of agreed power in time block 2
          $ref: "#/components/schemas/Decimal"
        casovniBlok3:
          description: Value of agreed power in time block 3
          $ref: "#/components/schemas/Decimal"
        casovniBlok4:
          description: Value of agreed power in time block 4
          $ref: "#/components/schemas/Decimal"
        casovniBlok5:
          description: Value of agreed power in time block 5
          $ref: "#/components/schemas/Decimal"
        veljavnost:
          description: Validity of agreed power
          type: boolean
        novUporabnik:
          description: Indicator if it is a new user
          type: boolean
        prikljucnaMoc:
          description: Connection power on which the agreed power was calculated
          $ref: "#/components/schemas/Decimal"
        minimalnaMoc:
          description: Value of minimum power
          $ref: "#/components/schemas/Decimal"

    NacinDolocitveDogovorjeneMoci:
      description: Method of determining agreed power
      type: string
      enum:
        - DISTRIBUTER
        - UPORABNIK

    OznakaIzracunaDogovorjeneMoci:
      description: Designation of agreed power calculation
      type: string
      enum:
        - M0
        - M1

    NacinObracuna:
      type: string
      enum:
        - PREDVIDENA_PORABA
        - DEJANSKA_PORABA

    OznakaDobavitelja:
      type: integer

    Eic:
      type: string

    Dobavitelj:
      description: Supplier of electrical energy for the metering point
      type: object
      properties:
        oznaka:
          $ref: "#/components/schemas/OznakaDobavitelja"
        eic:
          $ref: "#/components/schemas/Eic"
        naziv:
          type: string
        datumOd:
          type: string
          format: date
        datumDo:
          type: string
          format: date

    OpisNapake:
      description: Error description
      type: object
      properties:
        zahteva:
          description: Request identifier
          type: string
        errors:
          description: List of errors
          type: array
          items:
            $ref: "#/components/schemas/Napaka"

    Napaka:
      description: Error description and code
      type: object
      properties:
        koda:
          $ref: "#/components/schemas/KodaNapake"
        opis:
          description: Error description
          type: string

    KodaNapake:
      description: Error code
      type: string
      pattern: E\.\d\.\d{3}

  securitySchemes:
    X-API-TOKEN:
      type: apiKey
      in: header
      name: X-API-TOKEN
