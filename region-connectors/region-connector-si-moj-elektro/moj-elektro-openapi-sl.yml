openapi: 3.0.1
info:
  title: Moj elektro API
  description: Programski vmesnik do storitev za posredovanje podatkov uporabniku na portalu Moj Elektro
  version: "1.0"
  contact:
    email: podpora@mojelektro.si

servers:
  - description: Testno okolje
    url: https://api-test.informatika.si/mojelektro/v1
  - description: Produkcijsko okolje
    url: https://api.informatika.si/mojelektro/v1

security:
  - X-API-TOKEN: [ ]

paths:
  /meter-readings:
    get:
      tags:
        - meter-readings
      operationId: getMeterReadings
      summary: 15 minutni merilni podatki in dnevna stanja
      description: 15 minutni merilni podatki in dnevna stanja v CIM strukturi. Podrobni opisi posameznih registrov po katerih se lahko povpraĹĄuje se dobijo z metodo GET /reading-type.
      parameters:
        - $ref: "#/components/parameters/UsagePoint"
        - $ref: "#/components/parameters/StartTime"
        - $ref: "#/components/parameters/EndTime"
        - $ref: "#/components/parameters/Option"
      responses:
        200:
          $ref: "#/components/responses/MeterReadingsResponse"
        400:
          $ref: "#/components/responses/InvalidParametersErrorResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"

  /merilno-mesto/{identifikator}:
    get:
      tags:
        - merilno-mesto
      operationId: getMerilnoMesto
      summary: Podatki merilnega mesta
      description: Podatki o merilnem mestu s tehniÄnimi podrobnostmi
      parameters:
        - $ref: "#/components/parameters/Identifikator"
      responses:
        200:
          $ref: "#/components/responses/MerilnoMestoResponse"
        400:
          $ref: "#/components/responses/InvalidParametersErrorResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"
        404:
          $ref: "#/components/responses/NotFoundResponse"

  /merilna-tocka/{gsrn}:
    get:
      tags:
        - merilna-tocka
      operationId: getMerilnaTocka
      summary: Podatki merilne toÄke
      description: Pogodbeni podatki o merilni toÄki (plaÄnik, naslovnik, dobavitelj, ...)
      parameters:
        - $ref: "#/components/parameters/GsrnMerilneTocke"
      responses:
        200:
          $ref: "#/components/responses/MerilnaTockaResponse"
        400:
          $ref: "#/components/responses/InvalidParametersErrorResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"
        404:
          $ref: "#/components/responses/NotFoundResponse"

  /reading-qualities:
    get:
      tags:
        - reading-qualities
      operationId: getReadingQualities
      responses:
        200:
          $ref: "#/components/responses/ReadingQualitiesResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"

  /reading-type:
    get:
      tags:
        - reading-types
      operationId: getReadingTypes
      responses:
        200:
          $ref: "#/components/responses/ReadingTypesResponse"
        401:
          $ref: "#/components/responses/AuthorizationRequiredErrorResponse"
        403:
          $ref: "#/components/responses/NotAuthorizedErrorResponse"

components:
  parameters:
    UsagePoint:
      name: usagePoint
      description: Enotni identifikator merilnega mesta
      in: query
      schema:
        $ref: "#/components/schemas/Gsrn"

    StartTime:
      name: startTime
      description: Datum zaÄetka intervala povpraĹĄevanja v obliki LLLL-MM-DD
      in: query
      schema:
        $ref: "#/components/schemas/Date"

    EndTime:
      name: endTime
      description: Datum konca intervala povpraĹĄevanja v obliki LLLL-MM-DD
      in: query
      schema:
        $ref: "#/components/schemas/Date"

    Option:
      name: option
      description: "Seznam registrov po katerih se povpraĹĄuje. Posamezni register se vnese v obliki: ReadingType=32.0.2.4.1.2.12.0.0.0.0.0.0.0.0.3.72.0"
      in: query
      schema:
        $ref: "#/components/schemas/Options"

    Identifikator:
      description: Identifikator merilnega mesta
      name: identifikator
      in: path
      required: true
      schema:
        type: string

    GsrnMerilneTocke:
      description: GSRN merilne toÄke
      name: gsrn
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Gsrn"

  responses:
    MeterReadingsResponse:
      description: Odgovor za meritve
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/MeterReadings"

    MerilnoMestoResponse:
      description: Vsebuje podatke merilnega mesta
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/MerilnoMestoPolno"

    MerilnaTockaResponse:
      description: Vsebuje podatke merilne tocke
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/MerilnaTockaPolno"

    ReadingQualitiesResponse:
      description: Sifrant zaloge vrednosti za ReadingQualities
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ReadingQualities"

    ReadingTypesResponse:
      description: Sifrant zaloge vrednosti za ReadingType
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ReadingTypes"

    InvalidParametersErrorResponse:
      description: Napaka v vhodnih parametrih
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

    AuthorizationRequiredErrorResponse:
      description: Manjkajo avtorizacijski podatki
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

    NotAuthorizedErrorResponse:
      description: Podani avtorizacijski podatki ne omogocajo dostopa
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

    NotFoundResponse:
      description: Podatki niso bili najdeni
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Napaka"

  schemas:
    Gsrn:
      description: Enotni identifikator merilnega mesta
      type: string

    ReadingTypeValue:
      description: Tip odÄitka
      type: string

    ReadingTypes:
      type: array
      items:
        $ref: "#/components/schemas/ReadingType"

    ReadingType:
      type: object
      properties:
        naziv:
          description: Naziv
          type: string
        oznaka:
          description: Oznaka
          type: string
        tip:
          description: Tip
          type: string
        perioda:
          description: Perioda
          type: string
        opis:
          description: Opis
          type: string
        readingType:
          $ref: "#/components/schemas/ReadingTypeValue"
        readingTypeBrezObracuna:
          $ref: "#/components/schemas/ReadingTypeValue"
        readingTypeObracun:
          $ref: "#/components/schemas/ReadingTypeValue"
        vrsta:
          $ref: "#/components/schemas/ReadingTypeValueType"

    ReadingTypeValueType:
      type: string
      enum:
        - KOLICINA
        - STANJE

    ReadingValue:
      description: Vrednost odÄitka
      type: string

    ReadingQualityType:
      type: string

    ReadingQuality:
      description: Status odÄitka. Opisi posameznih statusov so na voljo v metodi GET /reading-qualities.
      type: object
      properties:
        readingQualityType:
          $ref: "#/components/schemas/ReadingQualityType"

    ReadingQualityWithDescription:
      allOf:
        - $ref: "#/components/schemas/ReadingQuality"
      type: object
      properties:
        description:
          description: Opis statusa odÄitka
          type: string

    ReadingQualities:
      type: array
      description: Seznam statusov odÄitka. V kolikor je seznam prazen ali ni prisoten, se odÄitek smatra kot validen.
      items:
        $ref: "#/components/schemas/ReadingQualityWithDescription"

    Date:
      type: string
      description: Äasovna znaÄka za datum ISO oblike
      example: 2023-19-12
      format: date

    DateTime:
      type: string
      description: Äasovna znaÄka ISO oblike z odmikom Äasovne cone
      example: 2023-12-19 00:00:15+02:00
      format: date-time

    Options:
      type: array
      items:
        $ref: "#/components/schemas/Option"

    Option:
      type: string
      description: Vrednost ReadingType po katerem se povpraĹĄuje
      pattern: .+=.+

    IntervalReading:
      description: OdÄitek
      type: object
      properties:
        timestamp:
          description: Äasovna znaÄka odÄitka
          type: string
          format: date-time
        value:
          $ref: "#/components/schemas/ReadingValue"
        readingQualities:
          description: Seznam statusov odÄitka
          type: array
          items:
            $ref: "#/components/schemas/ReadingQuality"

    IntervalBlock:
      description: Äasovni blok za posamezni register
      type: object
      properties:
        readingType:
          $ref: "#/components/schemas/ReadingTypeValue"
        intervalReadings:
          description: Seznam odÄitkov
          type: array
          items:
            $ref: "#/components/schemas/IntervalReading"

    MeterReadings:
      description: Vrednosti meritev
      type: object
      properties:
        usagePoint:
          $ref: "#/components/schemas/Gsrn"
        messageCreated:
          description: Äasovna znaÄka kreiranja sporoÄila
          type: string
          format: date-time
        intervalBlocks:
          description: Seznam Äasovnih blokov za posamezni register
          type: array
          items:
            $ref: "#/components/schemas/IntervalBlock"

    PoslovniPartner:
      description: Podatki poslovnega partnerja
      type: object
      properties:
        naziv:
          description: Naziv poslovnega partnerja
          type: string
        davcnaSt:
          description: DavÄna ĹĄt. poslovnega partnerja
          type: string
        maticnaSt:
          description: MatiÄna ĹĄt. poslovnega partnerja
          type: string
        naslov:
          description: Naslov poslovnega partnerja
          type: string

    VrstaMerilneTocke:
      description: Vrsta merilne toÄke
      type: string
      enum:
        - OMTO
        - MTP

    EnotniIdentifikatorMerilnegaMesta:
      description: Enotni identifikator merilnega mesta
      type: string

    IdentifikatorMerilnegaMesta:
      description: Identifikator merilnega mesta
      type: object
      properties:
        enotniIdentifikatorMerilnegaMesta:
          $ref: "#/components/schemas/EnotniIdentifikatorMerilnegaMesta"
        gsrn:
          $ref: "#/components/schemas/Gsrn"

    Decimal:
      type: string

    MerilnoMesto:
      description: Podatki merilnega mesta
      type: object
      properties:
        identifikator:
          $ref: "#/components/schemas/IdentifikatorMerilnegaMesta"
        merilneTocke:
          type: array
          items:
            $ref: "#/components/schemas/MerilnaTocka"

    MerilnoMestoPolno:
      description: Podatki merilnega mesta
      allOf:
        - $ref: "#/components/schemas/MerilnoMesto"
        - type: object
          properties:
            naziv:
              description: Naziv merilnega mesta
              type: string
            naslov:
              description: Naslov merilnega mesta
              type: string
            tockaPrikljucitve:
              description: ToÄka prikljuÄitve
              $ref: "#/components/schemas/TockaPrikljucitve"
            pogodbeniPodatki:
              description: Pogodbeni podatki
              $ref: "#/components/schemas/PogodbeniPodatki"
            lastnik:
              description: Lastnik merilnega mesta
              $ref: "#/components/schemas/PoslovniPartner"
            tehnicniPodatki:
              description: TehniÄni podatki merilnega mesta
              $ref: "#/components/schemas/TehnicniPodatki"

    TockaPrikljucitve:
      description: ToÄka prikljuÄitve merilnega mesta
      type: object
      properties:
        rtp:
          description: RTP
          type: string
        sn:
          description: SN izvod
          type: string
        tp:
          description: TP
          type: string
        nn:
          description: NN izvod
          type: string

    PogodbeniPodatki:
      description: Pogodbeni podatki merilnega mesta
      type: object
      properties:
        stevilkaSzP:
          description: Ĺ t. soglasja za priklop
          type: integer
        nazivNapetostnegaNivoja:
          description: Naziv napetostnega nivoja
          type: string
        oznakaNapetostnegaNivoja:
          description: Oznaka napetnostnega nivoja
          type: string
        nazivNacinaPrikljucitve:
          description: Naziv naÄina prikljuÄitve
          type: string
        oznakaNacinaPrikljucitve:
          description: Oznaka naÄina prikljuÄitve
          type: integer
        vrstaPrikljucka:
          description: Vrsta prikljuÄka
          type: string
        steviloFaz:
          description: Ĺ t. faz
          type: integer
        vrstaOmejevalcaToka:
          description: Vrsta omejevalca toka
          type: string
        idVrsteOmejevalcaToka:
          description: Identifikator vrste omejevalca toka
          type: integer
        jakostOmejevalcaToka:
          description: Jakost omejevalca toka
          type: integer
        prikljucnaMoc:
          description: PrikljuÄna moÄ
          type: integer
        instaliranaMocProizvodnje:
          description: Instalirana moÄ proizvodnje
          $ref: "#/components/schemas/Decimal"
        virPrimarnegaEnergenta:
          description: Vir primarnega energenta (vir energije) za proizvajalce
          type: string
        daljinskoCitanje:
          description: Zastavica, ali je merilno mesto na daljinskem odbiranju
          type: boolean
        obstoj15MinutneMeritve:
          description: Zastavica, ali ima merilno mesto 15 minutne meritve
          type: boolean
        idFrekvenceOdbiranja:
          description: Identifikator frekvence odbiranja
          type: integer
        nazivFrekvenceOdbiranja:
          description: Naziv frekvence odbiranja
          type: string
        mesecObracuna:
          description: Mesec obraÄuna
          type: integer

    TehnicniPodatki:
      description: TehniÄni podatki merilnega mesta
      type: object
      properties:
        tipStevca:
          description: Naziv tipa ĹĄtevca
          type: string
        statisticnaPopulacija:
          description: Oznaka statistiÄne populacije
          type: string
        tovarniskaStevilkaMkn:
          description: TovarniĹĄka ĹĄtevilka ĹĄtevca
          type: string
        velikostPopulacije:
          description: Velikost populacije
          type: integer
        letoIzdelave:
          description: Leto izdelave ĹĄtevca
          type: integer
        zaporednaStPreizkusa:
          description: Zaporedna ĹĄtevilka preizkusa
          type: integer
        datumVeljavnostiZiga:
          description: Datum veljavnosti Ĺžiga
          $ref: "#/components/schemas/Date"

    MerilnaTocka:
      description: Podatki merilne toÄke
      type: object
      properties:
        gsrn:
          $ref: "#/components/schemas/Gsrn"
        vrsta:
          $ref: "#/components/schemas/VrstaMerilneTocke"

    MerilnaTockaPolno:
      allOf:
        - $ref: "#/components/schemas/MerilnaTocka"
        - type: object
          properties:
            naziv:
              description: Naziv merilne toÄke
              type: string
            vrsta:
              $ref: "#/components/schemas/VrstaMerilneTocke"
            dobavitelj:
              $ref: "#/components/schemas/Dobavitelj"
            obracunIzgub:
              description: Zastavica, ali se na merilni toÄki obraÄunavajo izgube
              type: boolean
            procentIzgub:
              description: Procent izgub
              type: integer
            steviloTarifMerjenja:
              description: Ĺ t. tarif merjenja
              type: integer
            letneObratovalneUre:
              description: Letne obratovalne ure
              type: integer
            placnikAliProdajalec:
              description: PlaÄnik ali prodajalec na merlni toÄki
              $ref: "#/components/schemas/PoslovniPartner"
            naslovnik:
              description: Naslovnik na merilni toÄki
              $ref: "#/components/schemas/PoslovniPartner"
            obracunskaMoc:
              description: ObraÄunska (prikljuÄna) moÄ
              type: integer
            nacinObracuna:
              description: NaÄin obraÄuna
              $ref: "#/components/schemas/NacinObracuna"
            idVrstaOdjema:
              description: Identifikator vrste odjema
              type: integer
            nazivVrstaOdjema:
              description: Naziv vrste odjema
              type: string
            stPogodbeOUporabiSistema:
              description: Ĺ t. pogodbe o uporabi sistema
              type: string
            nacinOskrbe:
              description: NaÄin oskrbe
              type: string
            dogovorjeneMoci:
              description: Seznam dogovorjenih moÄi
              type: array
              items:
                $ref: "#/components/schemas/DogovorjenaMoc"
            merilnaMesta:
              description: Seznam merilnih mest, ki so udeleĹžene v tej merilni toÄki
              type: array
              items:
                $ref: "#/components/schemas/MerilnoMesto"

    DogovorjenaMoc:
      description: Podatki dogovorjene moÄi
      type: object
      properties:
        datumVnosa:
          description: Datum vnosa dogovorjene moÄi
          $ref: "#/components/schemas/Date"
        datumOd:
          description: Datum zaÄetka dogovorjene moÄi
          $ref: "#/components/schemas/DateTime"
        datumDo:
          description: Datum konca dogovorjene moÄi
          $ref: "#/components/schemas/DateTime"
        nacinDolocitve:
          description: NaÄin doloÄitve dogovorjene moÄi
          $ref: "#/components/schemas/NacinDolocitveDogovorjeneMoci"
        oznakaIzracuna:
          description: Oznaka izraÄuna dogovorjene moÄi
          $ref: "#/components/schemas/OznakaIzracunaDogovorjeneMoci"
        casovniBlok1:
          description: Vrednost dogovorjene moÄi v Äasovnem bloku 1
          $ref: "#/components/schemas/Decimal"
        casovniBlok2:
          description: Vrednost dogovorjene moÄi v Äasovnem bloku 2
          $ref: "#/components/schemas/Decimal"
        casovniBlok3:
          description: Vrednost dogovorjene moÄi v Äasovnem bloku 3
          $ref: "#/components/schemas/Decimal"
        casovniBlok4:
          description: Vrednost dogovorjene moÄi v Äasovnem bloku 4
          $ref: "#/components/schemas/Decimal"
        casovniBlok5:
          description: Vrednost dogovorjene moÄi v Äasovnem bloku 5
          $ref: "#/components/schemas/Decimal"
        veljavnost:
          description: Veljavnost dogovorjene moÄi
          type: boolean
        novUporabnik:
          description: Indikator, ali gre za novega uporabnika
          type: boolean
        prikljucnaMoc:
          description: PrikljuÄna moÄ, na podlagi katere je bila izraÄunana dogovorjena moÄ
          $ref: "#/components/schemas/Decimal"
        minimalnaMoc:
          description: Vrednost minimalne moÄi
          $ref: "#/components/schemas/Decimal"

    NacinDolocitveDogovorjeneMoci:
      description: NaÄin doloÄitve dogovorjene moÄi
      type: string
      enum:
        - DISTRIBUTER
        - UPORABNIK

    OznakaIzracunaDogovorjeneMoci:
      description: Oznaka izraÄuna dogovorjene moÄi
      type: string
      enum:
        - M0
        - M1

    NacinObracuna:
      type: string
      enum:
        - PREDVIDENA_PORABA
        - DEJANSKA_PORABA

    OznakaDobavitelja:
      type: integer

    Eic:
      type: string

    Dobavitelj:
      description: Dobavitelj elektriÄne energije za merilno toÄko
      type: object
      properties:
        oznaka:
          $ref: "#/components/schemas/OznakaDobavitelja"
        eic:
          $ref: "#/components/schemas/Eic"
        naziv:
          type: string
        datumOd:
          type: string
          format: date
        datumDo:
          type: string
          format: date

    OpisNapake:
      description: Opis napake
      type: object
      properties:
        zahteva:
          description: Identifikator zahteve
          type: string
        errors:
          description: Seznam napak
          type: array
          items:
            $ref: "#/components/schemas/Napaka"

    Napaka:
      description: Opis in koda napake
      type: object
      properties:
        koda:
          $ref: "#/components/schemas/KodaNapake"
        opis:
          description: Opis napake
          type: string

    KodaNapake:
      description: Koda napake
      type: string
      pattern: E\.\d\.\d{3}

  securitySchemes:
    X-API-TOKEN:
      type: apiKey
      in: header
      name: X-API-TOKEN
