{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://eddie.energy/schemas/region-connectors/cds",
  "$defs": {
    "CDSMetadata": {
      "type": "object",
      "properties": {
        "cds_metadata_version": {
          "type": "string",
          "description": "The version of metadata object format this Server follows, which for this version of the specification is v1.\n"
        },
        "cds_metadata_url": {
          "type": "string",
          "format": "uri",
          "description": "A URL link to this metadata object’s canonical network location."
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "When the metadata url was first made available."
        },
        "updated": {
          "type": "string",
          "format": "date-time",
          "description": "When this metadata object was last modified."
        },
        "name": {
          "type": "string",
          "description": "The name of the utility or entity (e.g. “Demo Gas & Electric”)."
        },
        "description": {
          "type": "string",
          "description": "A brief description about the utility or entity (e.g. “An electric and gas utility serving customers in Northern California”).\n"
        },
        "website": {
          "type": "string",
          "format": "uri",
          "description": "Where users can learn more about the utility or entity and its capabilities."
        },
        "documentation": {
          "type": "string",
          "format": "uri",
          "description": "Where Clients can find the utility or entity’s technical reference documentation."
        },
        "support": {
          "type": "string",
          "format": "uri",
          "description": "Where Clients can find contact information for technical support on the Server’s capabilities.\n"
        },
        "capabilities": {
          "description": "What capabilities and functionality this Server supports, which may be an empty array if the Server is not offering any additional capabilities beyond just this metadata object.\nIf the list of capabilities includes coverage, this array MUST also include a union of the capabilities listed in the Coverage Endpoint list of Coverage Entry objects’ capabilities values.\n",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "coverage": {
          "type": "string",
          "format": "uri",
          "description": "Where to find the Coverage Endpoint. This field is REQUIRED if coverage is listed in the capabilities array."
        },
        "related_metadata": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          },
          "description": "Where to find other related Metadata Endpoints."
        },
        "commodity_types": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "infrastructure_types": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "oauth_metadata": {
          "type": "string",
          "format": "uri",
          "description": "Endpoint for oauth metadata, only available if capabilities includes 'oauth'."
        }
      },
      "required": [
        "cds_metadata_version",
        "cds_metadata_url",
        "created",
        "updated",
        "name",
        "description",
        "website",
        "documentation",
        "support",
        "capabilities"
      ],
      "allOf": [
        {
          "if": {
            "properties": {
              "capabilities": {
                "type": "array",
                "contains": {
                  "const": "coverage"
                }
              }
            }
          },
          "then": {
            "required": [
              "coverage"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "capabilities": {
                "type": "array",
                "contains": {
                  "const": "oauth"
                }
              }
            }
          },
          "then": {
            "required": [
              "oauth_metadata"
            ]
          }
        }
      ]
    },
    "OAuthMetadata": {
      "type": "object",
      "properties": {
        "authorization_details_types_supported": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Lists which authorization details are supported such as 'client_admin' or 'customer_data'"
        },
        "authorization_endpoint": {
          "type": "string",
          "format": "uri"
        },
        "cds_client_settings_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_client_updates_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_clients_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_accounts_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_aggregations_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_billsections_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_billstatements_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_eacs_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_meterdevices_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_servicecontracts_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_servicepoints_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_customerdata_usagesegments_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_directory_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_grants_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_human_directory": {
          "type": "string",
          "format": "uri"
        },
        "cds_human_registration": {
          "type": "string",
          "format": "uri"
        },
        "cds_oauth_version": {
          "type": "string"
        },
        "cds_registration_fields": {
          "type": "object"
        },
        "cds_scope_credentials_api": {
          "type": "string",
          "format": "uri"
        },
        "cds_scope_descriptions": {
          "type": "object",
          "description": "Lists all scopes available",
          "additionalProperties": {
            "$ref": "#/$defs/CdsScopeDescription"
          }
        },
        "cds_test_accounts": {
          "type": "string",
          "format": "uri"
        },
        "code_challenge_methods_supported": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "grant_types_supported": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "introspection_endpoint": {
          "type": "string",
          "format": "uri"
        },
        "issuer": {
          "type": "string",
          "format": "uri"
        },
        "op_policy_uri": {
          "type": "string",
          "format": "uri"
        },
        "op_tos_uri": {
          "type": "string",
          "format": "uri"
        },
        "pushed_authorization_request_endpoint": {
          "type": "string",
          "format": "uri"
        },
        "registration_endpoint": {
          "type": "string",
          "format": "uri"
        },
        "response_types_supported": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "revocation_endpoint": {
          "type": "string",
          "format": "uri"
        },
        "scopes_supported": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "service_documentation": {
          "type": "string",
          "format": "uri"
        },
        "token_endpoint": {
          "type": "string",
          "format": "uri"
        },
        "token_endpoint_auth_methods_supported": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "authorization_details_types_supported",
        "authorization_endpoint",
        "cds_client_settings_api",
        "cds_client_updates_api",
        "cds_clients_api",
        "cds_customerdata_accounts_api",
        "cds_customerdata_aggregations_api",
        "cds_customerdata_billsections_api",
        "cds_customerdata_billstatements_api",
        "cds_customerdata_eacs_api",
        "cds_customerdata_meterdevices_api",
        "cds_customerdata_servicecontracts_api",
        "cds_customerdata_servicepoints_api",
        "cds_customerdata_usagesegments_api",
        "cds_directory_api",
        "cds_grants_api",
        "cds_human_directory",
        "cds_human_registration",
        "cds_oauth_version",
        "cds_registration_fields",
        "cds_scope_credentials_api",
        "cds_scope_descriptions",
        "cds_test_accounts",
        "code_challenge_methods_supported",
        "grant_types_supported",
        "introspection_endpoint",
        "issuer",
        "op_policy_uri",
        "op_tos_uri",
        "pushed_authorization_request_endpoint",
        "registration_endpoint",
        "response_types_supported",
        "revocation_endpoint",
        "scopes_supported",
        "service_documentation",
        "token_endpoint",
        "token_endpoint_auth_methods_supported"
      ]
    },
    "CdsScopeDescription": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "authorization_details_fields": {
          "type": "array"
        },
        "documentation": {
          "type": "string",
          "format": "uri"
        },
        "grant_types_supported": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "registration_optional": {
          "type": "array"
        },
        "registration_requirements": {
          "type": "array"
        },
        "response_types_supported": {
          "type": "array"
        },
        "token_endpoint_auth_methods_supported": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "authorization_details_fields",
        "description",
        "documentation",
        "grant_types_supported",
        "id",
        "name",
        "registration_optional",
        "registration_requirements",
        "response_types_supported",
        "token_endpoint_auth_methods_supported"
      ]
    },
    "CoverageListing": {
      "allOf": [
        {
          "$ref": "#/$defs/Page"
        },
        {
          "properties": {
            "coverage_entries": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/CoverageEntry"
              }
            }
          },
          "required": ["coverage_entries"]
        }
      ]
    },
    "CoverageEntry": {
      "type": "object",
      "description": "https://daniel-utilityapi.github.io/Connectivity/specs/cdsc-wg1-01/#coverage-entry-format",
      "properties": {
        "id": {
          "type": "string",
          "description": "A unique identifier for the coverage entry"
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "When this coverage entry was first made available"
        },
        "updated": {
          "type": "string",
          "format": "date-time",
          "description": "When this coverage entry was last modified"
        },
        "entity_name": {
          "type": "string",
          "description": "A human readable name for the entity being covered (e.g. “Demo Gas & Electric”). The entity name in a coverage entry MAY be different than the Server metadata name value in situations where the Server is operated by a parent or other entity."
        },
        "entity_abbreviation": {
          "type": [
            "string",
            "null"
          ],
          "description": "The abbreviation for the entity being covered by the coverage entry (e.g. “DG&E”). This field is to assist Clients in parsing coverage for entities that are commonly known by their abbreviated names (e.g. “DG&E” rather than “Demo Gas & Electric”). If no abbreviation is available for the entity being covered, this value is null."
        },
        "name": {
          "type": "string",
          "description": "A human readable name for the coverage area or category (e.g. “Upstate New York electric territory”)."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the coverage area or category"
        },
        "type": {
          "type": "string",
          "enum": [
            "geographic",
            "logical"
          ],
          "description": "The type of coverage entry"
        },
        "role": {
          "type": "string",
          "enum": [
            "authoritative",
            "official",
            "aggregator"
          ],
          "description": "The role of the Server in offering capabilities for the coverage entry"
        },
        "infrastructure_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "distribution_utility",
              "metering_provider",
              "supplier",
              "generator",
              "market_operator",
              "distribution_service_operator",
              "transmission_service_operator",
              "service_provider"
            ]
          },
          "description": "A list of infrastructure categories applicable to the coverage entry"
        },
        "commodity_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "electricity",
              "natural_gas",
              "fuel_oil",
              "water",
              "wastewater",
              "trash",
              "distributed_energy"
            ]
          },
          "description": "A list of services or commodities applicable to the coverage entry"
        },
        "capabilities": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "What capabilities and functionality this Server supports for the coverage entry"
        },
        "map_resource": {
          "type": "string",
          "format": "uri",
          "description": "Link to a map of the coverage territory"
        },
        "map_content_type": {
          "type": "string",
          "description": "Content-Type format of the map_resource"
        },
        "geojson_resource": {
          "type": "string",
          "format": "uri",
          "description": "Link to a GeoJSON object mapping the coverage territory"
        }
      },
      "required": [
        "id",
        "created",
        "updated",
        "entity_name",
        "entity_abbreviation",
        "name",
        "type",
        "role",
        "infrastructure_types",
        "commodity_types",
        "capabilities"
      ],
      "additionalProperties": false
    },
    "Page": {
      "type": "object",
      "properties": {
        "next": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "URL to the next page of results"
        },
        "previous": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "URL to the previous page of results"
        }
      },
      "additionalProperties": false
    },
    "ClientRegistrationRequest": {
      "type": "object",
      "properties": {
        "redirect_uris": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "scope": {
          "type": "string",
          "description": "A space separated list containing all the scopes that should be available for the client."
        }
      }
    },
    "ClientRegistrationResponse": {
      "description": "Modeled after Client Registration Response, see: https://www.rfc-editor.org/rfc/rfc7591#section-3.2.1",
      "type": "object",
      "properties": {
        "client_id": {
          "type": "string"
        },
        "client_id_issued_at": {
          "type": "integer",
          "description": "A unix timestamp when the client_id was issued."
        },
        "client_name": {
          "type": "string"
        },
        "client_secret": {
          "type": "string",
          "description": "A client_secret value MUST be present in the response and be limited to client_admin scope use only."
        },
        "client_secret_expires_at": {
          "type": "integer",
          "description": "A unix timestamp when the client_secret expires, if equals to 0 it never expires."
        },
        "redirect_uris": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "grant_types": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "response_types": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "scope": {
          "type": "string",
          "description": "Space separated list of scopes, must include 'client_admin'",
          "pattern": ".*client_admin.*"
        },
        "token_endpoint_auth_method": {
          "type": "string",
          "enum": [
            "client_secret_basic"
          ]
        },
        "cds_server_metadata": {
          "type": "string",
          "format": "uri",
          "description": "Where the Client can find their registration-specific version of the CDSC-WG1-01 Server Metadata. If the Client’s CDSC server metadata is no different from the public CDSC server metadata, Servers MAY simply link to the public URL. If this metadata endpoint requires authentication, Servers MUST authenticate Client requests to this endpoint via Bearer access token obtained using OAuth’s client_credentials grant with a scope of client_admin, and reject unauthenticated requests with a 401 Unauthorized response code. Clients know that they must use a Bearer token when Servers return a 401 response code for this endpoint when the Client makes an unauthenticated request to the endpoint."
        },
        "cds_clients_api": {
          "type": "string",
          "format": "uri",
          "description": "The base url for the Clients API."
        },
        "cds_client_messages_api": {
          "type": "string",
          "format": "uri",
          "description": "The base url for the Clients Messages API."
        },
        "cds_scope_credentials_api": {
          "type": "string",
          "format": "uri",
          "description": "The base url for the Scope Credentials API."
        },
        "cds_grants_api": {
          "type": "string",
          "format": "uri",
          "description": "The base url for the Grants API."
        }
      },
      "required": [
        "client_id",
        "client_secret",
        "scope",
        "token_endpoint_auth_method",
        "cds_server_metadata",
        "cds_clients_api",
        "cds_client_messages_api",
        "cds_scope_credentials_api",
        "cds_grants_api"
      ]
    }
  }
}