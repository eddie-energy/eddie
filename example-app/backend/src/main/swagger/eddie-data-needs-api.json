{
  "openapi": "3.1.0",
  "info": {
    "title": "OpenAPI definition",
    "version": "v0"
  },
  "servers": [
    {
      "url": "https://eddie-demo.projekte.fh-hagenberg.at/hardening/eddie/data-needs",
      "description": "Generated server url"
    }
  ],
  "tags": [
    {
      "name": "Data needs public API",
      "description": "Used by the frontend to get information about data needs."
    }
  ],
  "paths": {
    "/api": {
      "get": {
        "tags": [
          "Data needs public API"
        ],
        "summary": "Get a list of IDs and names of all data needs",
        "operationId": "getDataNeedIdsAndNames",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DataNeedsNameAndIdProjection"
                },
                "example": [
                  {
                    "name": "My awesome data need",
                    "id": "207defb8-3aad-4281-a6ef-d77ba1601217"
                  },
                  {
                    "name": "Another data need",
                    "id": "my-id"
                  }
                ]
              }
            }
          }
        }
      }
    },
    "/api/{id}": {
      "get": {
        "tags": [
          "Data needs public API"
        ],
        "summary": "Get details of an existing data need",
        "operationId": "getDataNeed",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "String"
            },
            "example": "7f57cf16-5121-42a6-919e-7f7335826e64"
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "oneOf": [
                    {
                      "$ref": "#/components/schemas/AccountingPointDataNeed"
                    },
                    {
                      "$ref": "#/components/schemas/ValidatedHistoricalDataDataNeed"
                    },
                    {
                      "$ref": "#/components/schemas/AiidaDataNeed"
                    }
                  ]
                },
                "example": {
                  "type": "validated",
                  "id": "d73f44e1-239c-4610-b1e4-212ae35a792e",
                  "name": "My awesome data need",
                  "description": "descr",
                  "purpose": "purpose",
                  "policyLink": "https://example.com/toc",
                  "createdAt": "2024-03-14T06:16:49.983259Z",
                  "duration": {
                    "type": "relativeDuration",
                    "start": "P-1Y",
                    "end": "P12M"
                  },
                  "energyType": "ELECTRICITY",
                  "minGranularity": "PT15M",
                  "maxGranularity": "PT15M"
                }
              }
            }
          },
          "404": {
            "description": "No data need with the supplied id was found.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/EddieApiError"
                  }
                },
                "example": {
                  "errors": [
                    {
                      "message": "No data need with ID '7f57cf16-5121-42a6-919e-7f7335826e64' found."
                    }
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "DataNeedsNameAndIdProjection": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "id": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "name"
        ]
      },
      "AccountingPointDataNeed": {
        "type": "object",
        "description": "Data need for accounting point information request, i.e. information about the customer and their metering point.",
        "properties": {
          "id": {
            "type": "string",
            "readOnly": true
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "description": "Description of the data need for internal use. It is not displayed to the user.",
            "minLength": 1
          },
          "purpose": {
            "type": "string",
            "description": "Purpose and description of this data need that will be displayed to the user in the popup.",
            "minLength": 1
          },
          "policyLink": {
            "type": "string",
            "description": "URL to a document describing the data policy.",
            "example": "https://example.com/your-terms",
            "minLength": 1
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "readOnly": true
          },
          "enabled": {
            "type": "boolean"
          },
          "type": {
            "type": "string",
            "default": "account"
          },
          "regionConnectorFilter": {
            "$ref": "#/components/schemas/RegionConnectorFilter"
          }
        },
        "required": [
          "description",
          "id",
          "name",
          "policyLink",
          "purpose",
          "type",
          "type"
        ]
      },
      "RegionConnectorFilter": {
        "type": "object",
        "description": "Can be used to restrict which region connectors can process a data need. The list can be used as a blocklist or allowlist.",
        "properties": {
          "type": {
            "type": "string",
            "description": "If set to 'blocklist', the region connectors in the list will not be able to process the data need. If set to 'allowlist', only the region connectors in the list will be able to process the data need.",
            "enum": [
              "blocklist",
              "allowlist"
            ]
          },
          "regionConnectorIds": {
            "type": "array",
            "description": "List of region connector IDs that should be blocked or allowed. IDs are unique and can be found in the region connector's metadata. Typically, the region connector ID is the country code + '-' + a handle for the data provider, e.g. 'at-eda', 'fr-enedis', 'es-datadis', 'dk-energinet', 'fi-finngrid', 'us-green-button',...",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "regionConnectorIds",
          "type"
        ]
      },
      "AbsoluteDuration": {
        "allOf": [
          {
            "$ref": "#/components/schemas/DataNeedDuration"
          },
          {
            "type": "object",
            "properties": {
              "start": {
                "type": "string",
                "format": "date"
              },
              "end": {
                "type": "string",
                "format": "date"
              }
            }
          }
        ],
        "description": "Describes a duration with a fixed start/end date. When using an absolute duration, consider that most MDAs limit the timeframe for data requests (e.g. 2 years into the past), therefore at some point, it will not be possible anymore to fulfill the data need.",
        "properties": {
          "type": {
            "type": "string",
            "default": "absoluteDuration"
          }
        },
        "required": [
          "end",
          "start",
          "type"
        ]
      },
      "DataNeedDuration": {
        "discriminator": {
          "propertyName": "type"
        },
        "properties": {
          "type": {
            "type": "string"
          }
        },
        "required": [
          "type"
        ]
      },
      "RelativeDuration": {
        "allOf": [
          {
            "$ref": "#/components/schemas/DataNeedDuration"
          },
          {
            "type": "object",
            "properties": {
              "start": {
                "type": "string",
                "description": "ISO8601 duration string representing the period that should be added or subtracted from the current date to get the permission start date, when a new permission request for this data need is created. If not supplied, a region connector will use the earliest date possible date as permission request start date.",
                "example": "-P3M"
              },
              "end": {
                "type": "string",
                "description": "ISO8601 duration string representing the period that should be added or subtracted from the current date to get the permission end date, when a new permission request for this data need is created. If not supplied, a region connector will use the latest possible date as permission request end date.",
                "example": "P1Y4M12D"
              },
              "stickyStartCalendarUnit": {
                "type": "string",
                "description": "The CalendarUnit to which the start of the relative duration should stick to. E.g., assume today is the 17.04., the relative start is -25 days and CalendarUnit is MONTH, then, for a permission request that is created today, the start date should not be the 23.03, but it should stick to the start of the CalendarUnit, and therefore be 01.03. Furthermore, for a permission request that is created on the 26.04, the start date should be the 01.04 and so forth. For the CalendarUnit WEEK, it will stick to Mondays. Note that this may lead to an earlier start date than what is passed via the start period.",
                "enum": [
                  "WEEK",
                  "MONTH",
                  "YEAR"
                ]
              }
            }
          }
        ],
        "description": "Describes a duration with a relative start/end date. A date-period is specified which will be added/subtracted from the current date at the creation time of a permission request, i.e. when the customer clicks 'Connect' in the pop-up.",
        "properties": {
          "type": {
            "type": "string",
            "default": "relativeDuration"
          }
        },
        "required": [
          "type"
        ]
      },
      "ValidatedHistoricalDataDataNeed": {
        "type": "object",
        "description": "Data need for validated historical consumption data. For most MDAs, data for the previous day is made available sometime during the current day (e.g. at noon).",
        "properties": {
          "id": {
            "type": "string",
            "readOnly": true
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "description": "Description of the data need for internal use. It is not displayed to the user.",
            "minLength": 1
          },
          "purpose": {
            "type": "string",
            "description": "Purpose and description of this data need that will be displayed to the user in the popup.",
            "minLength": 1
          },
          "policyLink": {
            "type": "string",
            "description": "URL to a document describing the data policy.",
            "example": "https://example.com/your-terms",
            "minLength": 1
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "readOnly": true
          },
          "enabled": {
            "type": "boolean"
          },
          "type": {
            "type": "string",
            "default": "validated"
          },
          "regionConnectorFilter": {
            "$ref": "#/components/schemas/RegionConnectorFilter"
          },
          "duration": {
            "oneOf": [
              {
                "$ref": "#/components/schemas/AbsoluteDuration"
              },
              {
                "$ref": "#/components/schemas/RelativeDuration"
              }
            ]
          },
          "energyType": {
            "type": "string",
            "enum": [
              "ELECTRICITY",
              "NATURAL_GAS",
              "HYDROGEN",
              "HEAT"
            ]
          },
          "minGranularity": {
            "type": "string",
            "enum": [
              "PT5M",
              "PT10M",
              "PT15M",
              "PT30M",
              "PT1H",
              "P1D",
              "P1M",
              "P1Y"
            ]
          },
          "maxGranularity": {
            "type": "string",
            "enum": [
              "PT5M",
              "PT10M",
              "PT15M",
              "PT30M",
              "PT1H",
              "P1D",
              "P1M",
              "P1Y"
            ]
          }
        },
        "required": [
          "description",
          "duration",
          "energyType",
          "id",
          "maxGranularity",
          "minGranularity",
          "name",
          "policyLink",
          "purpose",
          "type",
          "type"
        ]
      },
      "AiidaDataNeed": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "readOnly": true
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "description": "Description of the data need for internal use. It is not displayed to the user.",
            "minLength": 1
          },
          "purpose": {
            "type": "string",
            "description": "Purpose and description of this data need that will be displayed to the user in the popup.",
            "minLength": 1
          },
          "policyLink": {
            "type": "string",
            "description": "URL to a document describing the data policy.",
            "example": "https://example.com/your-terms",
            "minLength": 1
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "readOnly": true
          },
          "enabled": {
            "type": "boolean"
          },
          "type": {
            "type": "string"
          },
          "regionConnectorFilter": {
            "$ref": "#/components/schemas/RegionConnectorFilter"
          },
          "duration": {
            "oneOf": [
              {
                "$ref": "#/components/schemas/AbsoluteDuration"
              },
              {
                "$ref": "#/components/schemas/RelativeDuration"
              }
            ]
          },
          "transmissionSchedule": {
            "$ref": "#/components/schemas/CronExpression",
            "description": "The schedule in cron format, at which the AIIDA instance should send data."
          },
          "schemas": {
            "type": "array",
            "description": "Define the schema for the outgoing data (Raw, CIM, Saref)",
            "items": {
              "type": "string",
              "enum": [
                "SMART-METER-P1-RAW",
                "SMART-METER-P1-CIM"
              ]
            },
            "minItems": 1,
            "uniqueItems": true
          },
          "asset": {
            "type": "string",
            "description": "The kind of asset the data is retrieved from ('CONNECTION-AGREEMENT-POINT', 'CONTROLLABLE-UNIT', 'DEDICATED-MEASUREMENT-DEVICE', 'SUBMETER')",
            "enum": [
              "CONNECTION-AGREEMENT-POINT",
              "CONTROLLABLE-UNIT",
              "DEDICATED-MEASUREMENT-DEVICE",
              "SUBMETER"
            ]
          },
          "dataTags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "uniqueItems": true
          }
        },
        "required": [
          "asset",
          "description",
          "duration",
          "id",
          "name",
          "policyLink",
          "purpose",
          "schemas",
          "transmissionSchedule",
          "type"
        ]
      },
      "CronExpression": {

      },
      "EddieApiError": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          }
        }
      }
    }
  }
}
